include: macros_output/functions.def

subcode:: parsecode_func_other
    $case $func =~/^(return_type|parameter|lexical)$/
        $if $cur_function
            my $func=$cur_function
            $if $1 eq "return_type"
                $func->{ret_type}=$param
            $elif $1 eq "parameter"
                $call add_function_params, $cur_function
        return
    $case $func =~/^(global|local)$/
        $if $1 eq "global"
            global_add_var($param)
        $else
            local_add_var($param)
        return

#----------------------------------------------- 
fncode: get_fortran_type($p)
    my $type
    $if $p=~/^f/i
        $type=$default_float
    $elif $p=~/^d/i
        $type="DOUBLE PRECISION"
    $elif $p=~/^z/i
        $type="COMPLEX*16"
    $elif $p=~/^s/i
        $type="CHARACTER"
    $elif $p=~/^[ijklmn]/i
        $type="INTEGER"
    $else
        $type=$default_float
    return $type

#----------------------------------------------- 
macros:
    function_style: fortran

subcode: function_param_fortran
    my ($type, $name, $dim)=parse_var($p)
    $var_hash->{$name}={name=>$name, type=>$type, dim=>$dim}
    push @$param_list, $name

    $if !$type && $name=~/^\s*(\S.*)\s+(\S+)$/
        ($type, $name)=($1, $2)

    my $var={}
    $if $name=~/(\w+)\((.*)\)/
        $name=$1
        $dim =$2
    return ($type, $name, $dim)

subcode: function_open_fortran
    my $ret_type = $func->{ret_type}
    my $param_list = $func->{param_list}
    my $param = join(', ', @$param_list)
    $if !$ret_type
        push @$open, "SUBROUTINE $name($param)"
    $else
        push @$open, "$ret_type FUNCTION $name($param)"

subcode: function_close_fortran
    push @$close, "END"
    push @$close, "NEWLINE"

subcode: infer_return_fortran
# ----------------------------
subcode: declare_var_list(out, hash, @list)
    my %type_list
    $foreach $p in $(list)
        my $type=$(hash)->{$p}->{type}
        my $dim=$(hash)->{$p}->{dim}
        my $name=$p
        $if $dim
            $if $type eq "CHARACTER"
                $name.="*$dim"
            $else
                $name.="($dim)"

        $if !$type_list{$type}
            $type_list{$type}=[]
        push @{$type_list{$type}}, $name


    $foreach %type_list
        push @$(out), "$k ".join(", ", @$v)

